<div class="flex justify-center h-auto auth-main-con 3xl:h-screen">
  <div *ngIf="!registrationSuccess; else RegistrationSuccess"
    class="max-w-md overflow-hidden h-fit lg:max-w-lg lg:h-full login-content flex-row-fluid d-flex flex-column justify-content-center position-relative">
    <div class="w-full px-2 mt-0 d-flex flex-column-fluid flex-center md:px-0">
      <mat-stepper [linear]="true" labelPosition="bottom" #stepper class="w-full h-full pb-6 text-center pt-14">
        <!-- #enddocregion label-position -->
        <mat-step>
          <h1 class="text-dark">Welcome! First things first.</h1>
          <h3 class="mb-9">Let's make sure we understand your company. What describes your business best?</h3>
          <form [formGroup]="registrationForm" class="flex flex-row flex-wrap justify-evenly categories-step">
              <ng-template matStepLabel>Your Market</ng-template>
              <ng-container *ngFor="let category of categories">
              <app-category-radio-button [customClass]="'w-29'" name="businessType" [value]="category.name" required>
                  <div class="tabs w-14 h-14" [ngClass]="{'active' : f['businessType'].value == category.name}">

                    <img [src]="category.img" alt="category.name">
                  </div>
                  <strong class="text-xs">{{category.name}}</strong>
                </app-category-radio-button>
              </ng-container>
            </form>
            <button class="text-white bg-black rounded-lg h-9 mt-7 w-28" [disabled]="!f['businessType'].value" mat-button matStepperNext>Next</button>
          </mat-step>
          <mat-step>
            <h1 class="text-dark">Let's get to know each other!</h1>
            <h3 class="mb-7">How can we reach out?</h3>
            <form class="text-left form w-100" [formGroup]="registrationForm" novalidate="novalidate">
              <ng-template matStepLabel>Contact Details</ng-template>
              <h2 class="text-left text-dark text-base mb-2.5">Your Contact Details</h2>
            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">First Name</label>
              <input class="form-control form-control-lg form-control-solid" type="text" name="firstName"
              placeholder="First Name"
                formControlName="firstName" autocomplete="off" [ngClass]="{
                'is-invalid': f['firstName'].invalid && f['firstName'].touched,
                'is-valid': f['firstName'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'First name is required',
                            control: f['firstName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'minlength',
                            message: 'First name should have at least 3 letters',
                            control: f['firstName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'First name should have maximum 30 letters',
                            control: f['firstName']}">
              </ng-container>
            </div>

            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">Last Name</label>
              <input class="form-control form-control-lg form-control-solid" type="text" name="lastName"
              placeholder="Last Name"
                formControlName="lastName" autocomplete="off" [ngClass]="{
                'is-invalid': f['lastName'].invalid && f['lastName'].touched ,
                'is-valid': f['lastName'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Last name is required',
                            control: f['lastName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'minlength',
                            message: 'Last name should have at least 3 letters',
                            control: f['lastName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'Last name should have maximum 30 letters',
                            control: f['lastName']}">
              </ng-container>
            </div>


            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">Email</label>
              <input class="form-control form-control-lg form-control-solid" type="email" name="email"
              placeholder="Daviddeens@gmail.com"
                formControlName="email" autocomplete="off" [ngClass]="{
                'is-invalid': f['email'].invalid && f['email'].touched,
                'is-valid': f['email'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Email is required',
                            control: f['email']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'pattern',
                            message: 'Email is invalid',
                            control: f['email']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'Email should have maximum 60 letters',
                            control: f['email']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                  validation: 'emailExists',
                  message: 'This email is already registered to a user',
                  control: f['email']}">
              </ng-container>
            </div>
            <!-- <div class="text-xs text-danger" *ngIf="registrationForm.controls['email']?.errors?.['emailExists']">
              This email is already registered to a user
            </div> -->

            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">Mobile</label>
              <div class="flex">
                <input
                  formControlName="phoneNumber"
                  name="phoneNumber"
                  maxlength="15"
                  appNumbersOnly
                  class="pr-3 text-sm form-control form-control-lg form-control-solid" type="text"
                  ng2TelInput
                  [ng2TelInputOptions]="{initialCountry: 'be'}"
                  (countryChange)="onCountryChange($event)">
              </div>

              <ng-container *ngIf="f['phoneNumber'].touched" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Mobile is required',
                            control: f['phoneNumber']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'validatePhoneNumber',
                            message: 'Mobile is invalid',
                            control: f['phoneNumber']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'min',
                            message: 'Mobile should have 9 letters',
                            control: f['phoneNumber']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'max',
                            message: 'Mobile should have 9 letters',
                            control: f['phoneNumber']}">
              </ng-container>
            </div>

            <div class="flex justify-between">
              <button class="h-10 mt-2.5 text-white bg-black rounded-lg w-28 back" mat-button matStepperPrevious>Back</button>
              <button class="h-10 mt-2.5 text-white bg-black rounded-lg w-28" [disabled]="f['firstName'].invalid || f['lastName'].invalid || f['email'].invalid || f['phoneNumber'].invalid" mat-button matStepperNext>Next</button>
            </div>
          </form>
          </mat-step>
          <mat-step>
            <h1 class="text-dark">Tell us about your business.</h1>
            <h3 class="mb-7">Where can we find you?</h3>
            <ng-container *ngIf="hasError">
              <div class="mb-lg-15 alert alert-danger">
                <div class="alert-text font-weight-bold">
                  The details are incorrect
                </div>
              </div>
            </ng-container>
            <form class="text-left form w-100" [formGroup]="registrationForm" novalidate="novalidate">
              <ng-template matStepLabel>Business Details</ng-template>
              <h1 class="text-left text-dark text-base mb-2.5">Your business details</h1>
            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">Company Name</label>
              <input class="form-control form-control-lg form-control-solid" type="text" name="companyName"
              placeholder="Company Name"
                formControlName="companyName" autocomplete="off" [ngClass]="{
                'is-invalid': f['companyName'].invalid && f['companyName'].touched,
                'is-valid': f['companyName'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Company Name is required',
                            control: f['companyName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'minlength',
                            message: 'Company Name should have at least 3 letters',
                            control: f['companyName']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'Company Name should have maximum 30 letters',
                            control: f['companyName']}">
              </ng-container>
            </div>

            <div class="h-90px fv-row">
              <label class="mb-1 text-sm form-label">Street Address</label>
              <input class="form-control form-control-lg form-control-solid" type="text" name="streetAddress"
              placeholder="Street Address"
                formControlName="streetAddress" autocomplete="off" [ngClass]="{
                'is-invalid': f['streetAddress'].invalid && f['streetAddress'].touched ,
                'is-valid': f['streetAddress'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Street Address is required',
                            control: f['streetAddress']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'minlength',
                            message: 'Street Address should have at least 3 letters',
                            control: f['streetAddress']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'Street Address should have maximum 100 letters',
                            control: f['streetAddress']}">
              </ng-container>
            </div>

            <div class="h-90px fv-row">
              <div class="flex">
                <div class="mr-3" style="width: 170px;">
                  <div>
                    <label class="mb-1 text-sm form-label">Zip</label>
                    <input maxlength="4" appNumbersOnly class="form-control form-control-lg form-control-solid" type="text" name="zipCode"
                    autocomplete="off" formControlName="zipCode" [ngClass]="{
                      'is-invalid': f['zipCode'].invalid && f['zipCode'].touched,
                      'is-valid': f['zipCode'].valid}" />
                  </div>
                  <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                    validation: 'required',
                    message: 'Zip is required',
                    control: f['zipCode']}">
                  </ng-container>
                  <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                    validation: 'zipInvalid',
                    message: 'Incorrect zipcode',
                    control: f['zipCode']}">
                  </ng-container>
                  <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                    validation: 'minLength',
                    message: 'Incorrect zipcode',
                    control: f['zipCode']}">
                    </ng-container>
                </div>
                <div class="w-full">
                    <div>
                        <label class="mb-1 text-sm form-label">City</label>
                        <input class="form-control form-control-lg form-control-solid" type="text" name="city"
                        autocomplete="off" formControlName="city" [ngClass]="{
                          'is-invalid': f['city'].invalid && f['city'].touched,
                          'is-valid': f['city'].valid}" />
                    </div>
                    <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                                  validation: 'required',
                                  message: 'City is required',
                                  control: f['city']}">
                    </ng-container>
                    <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                                  validation: 'min',
                                  message: 'City should have at least 3 letters',
                                  control: f['city']}">
                    </ng-container>
                    <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                                  validation: 'max',
                                  message: 'City should have maximum 100 letters',
                                  control: f['city']}">
                    </ng-container>
                  </div>
                </div>
            </div>

            <div class="flex flex-wrap fv-row province">
              <label class="w-full mb-1 text-sm form-label">Province</label>
              <ng-container *ngFor="let province of provincese">
                <app-category-radio-button class="w-fit h-9 p-2.5 mb-2 mr-2" [customClass]="'flex'" name="province" [ngClass]="{'active' : f['province'].value == province.id}" [value]="province.id">
                  <strong class="text-xs font-normal" style="font-size: 14px;">{{province.name}}</strong>
                </app-category-radio-button>
              </ng-container>
            </div>
            <ng-container *ngIf="f['province'].value == null && registrationForm.dirty">
              <div class="text-xs text-danger">Please select a Province</div>
            </ng-container>

            <div class="mt-3 mb-2 fv-row">
              <label class="mb-1 text-sm form-label">Website or social media url</label>
              <input class="form-control form-control-lg form-control-solid" type="text" name="website_socialAppLink"
              placeholder="Website"
                formControlName="website_socialAppLink" autocomplete="off" [ngClass]="{
                'is-invalid': f['website_socialAppLink'].invalid && f['website_socialAppLink'].touched ,
                'is-valid': f['website_socialAppLink'].valid}" />
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'required',
                            message: 'Website is required',
                            control: f['website_socialAppLink']}">
              </ng-container>
              <!-- <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'pattern',
                message: 'Url is invalid',
                (keyup)="matchZipCodeWithCity()"
                control: f['website_socialAppLink']}">
              </ng-container> -->
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'minlength',
                            message: 'Website should have at least 3 letters',
                            control: f['website_socialAppLink']}">
              </ng-container>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                            validation: 'maxlength',
                            message: 'Website should have maximum 100 letters',
                            control: f['website_socialAppLink']}">
              </ng-container>

              <div class="text-xs text-danger"
                *ngIf="registrationForm.controls['website_socialAppLink']?.errors?.['invalidUrl']">
                Url is Invalid
            </div>

          </div>

            <div class="flex justify-between">
              <button class="text-white bg-black rounded-lg h-9 mt-9 w-28 back" mat-button matStepperPrevious>Back</button>
              <button (click)="submit()" class="h-10 text-white bg-black rounded-lg mt-9 w-28" [disabled]="registrationForm.invalid" mat-button>
                <ng-container *ngIf="isLoading$ | async">
                  Loading...
                </ng-container>
                <ng-container *ngIf="!(isLoading$ | async)">
                  Next
                </ng-container>
              </button>
            </div>
          </form>
          </mat-step>
          <ng-template matStepperIcon="edit" let-index="index">
            <mat-icon>done</mat-icon>
          </ng-template>
        </mat-stepper>

    </div>

  </div>
</div>

<ng-template #RegistrationSuccess>
  <div class="relative flex flex-col items-center self-center justify-center w-full px-2 mx-2 registration-success rounded-xl h-60">
    <mat-icon class="absolute flex items-center justify-center text-white rounded-full w-9 h-9 -top-4"
    style="background-color: #3DD980;">done</mat-icon>
    <p class="text-base text-center">Congrats! You have successfully completed your application. We will be in touch within 24hrs. Feel free to browse our deal offers and get inspired by other merchants.</p>
    <button class="h-10 text-white bg-black rounded-lg mt-9 w-60" mat-button (click)="registrationSuccessOk()">Bring me back to the store</button>
  </div>
</ng-template>

  <ng-template #formError let-control="control" let-message="message" let-validation="validation">
    <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
      <div style="font-size: 10px;" class="w-full fv-plugins-message-container">
        <span style="font-size: 10px;" class="fv-help-block" role="alert">
          {{ message }}
        </span>
      </div>
    </ng-container>
  </ng-template>
