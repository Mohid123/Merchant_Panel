<app-side-drawer></app-side-drawer>

<!--Title/ Header-->
<div class="mb-6 lg:text-center">
  <h1 class="mt-2 mb-2 text-lg text-center md:text-xl xl:mt-4 xl:text-2xl 3xl:text-3xl">Let's set up your deal.</h1>
  <div class="text-xs font-thin text-center text-primary-400 md:text-sm xl:text-base 3xl:text-lg">First impression matters! Let's start with creating your titles and description.</div>
</div>
<!--Card for Creating Deal-->
<div class="flex flex-col w-full h-auto gap-2 md:flex-row md:h-136 2xl:h-180 3xl:h-216">
  <div class="w-full p-6 shadow-sm md:overflow-y-auto card card-custom">
      <form class="form row" [formGroup]="dealForm">
        <!--Form-->
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Select sub-category</label>
          <div #myDrop="ngbDropdown" ngbDropdown class="w-full rounded-lg d-inline-block">
            <button [disabled]="disableCategory == true" type="button" class="w-full text-xs text-left btn text-font-gray-600" [class.open]="myDrop.isOpen()" id="dropdownBasic1"
            ngbDropdownToggle>{{selectedcategory?.subCategoryName || '-Select'}}</button>
            <div class="w-full" ngbDropdownMenu aria-labelledby="dropdownBasic1">
              <ng-container *ngFor="let category of categoryList?.data" >
                <button ngbDropdownItem (click)="ChangeSelectedCategory(category)">{{category.subCategoryName}}</button>
              </ng-container>
            </div>
          </div>
          <!-- <input appTrim type="text font-weight-light" class="text-sm font-thin form-control" formControlName="subCategory" name="subCategory" placeholder="Select subCategory of your deal"
          > -->
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'sub-category is required',
            control: dealForm.controls['subCategory']
          }">
          </ng-container>
        </div>
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Title</label>
          <input maxlength="16" appTrim type="text font-weight-light" class="text-sm font-thin form-control" formControlName="title" name="title" placeholder="Enter title of your deal"
          [ngClass]="{
            'is-invalid': f['title'].invalid && f['title'].touched,
            'is-valid': f['title'].valid}">
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Deal title is required',
            control: dealForm.controls['title']
          }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Title should at least be 3 characters',
              control: dealForm.controls['title']
            }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: dealForm.controls['title']
          }">
          </ng-container>
        </div>
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Subtitle</label>
          <input maxlength="150" appTrim type="text font-weight-light" class="text-sm font-thin form-control" formControlName="subTitle" name="subTitle" placeholder="Enter subtitle of your deal"
          [ngClass]="{
            'is-invalid': f['subTitle'].invalid && f['subTitle'].touched,
            'is-valid': f['subTitle'].valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Subtitle is required',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Subtitle should at least be 3 characters',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: dealForm.controls['subTitle']
          }">
            </ng-container>
        </div>
        <div class="h-36 fv-row">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Description</label>
          <textarea maxlength="2000" appTrim type="text font-weight-light" class="text-sm font-thin form-control" formControlName="description" name="description" placeholder="Description" rows="5"
          [ngClass]="{
            'is-invalid': f['description'].invalid && f['description'].touched,
            'is-valid': f['description'].valid}"></textarea>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'A description for the deal is required',
            control: dealForm.controls['description']
          }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'minlength',
            message: 'Description should at least be 16 characters',
            control: dealForm.controls['description']
          }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
          validation: 'pattern',
          message: 'Special characters (! / ? * & % @ : #) are not allowed',
          control: dealForm.controls['description']
        }">
          </ng-container>
        </div>
        <div class="fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">About this deal</label>
          <ckeditor tagName="textarea" formControlName="finePrint" [editor]="Editor" [config]="config"></ckeditor>
        </div>
      </form>
  </div>
  <div class="flex flex-col w-full gap-2">
<div class="px-8 py-5 shadow-sm h-54 2xl:h-68 card card-custom 3xl:h-80">
  <label class="font-medium text-black">Media clip</label>
  <div *ngIf="!videos || videos.length == 0"  class="self-center my-4 image-input image-input-outline image-upload">
    <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none; opacity: 0.8;"></div>
    <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
      <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20" style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20" src="../../../../../assets/media/icons/video-play.svg"></span>
      <input class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20" type="file" accept="video/mp4 , .FLV" (change)="onSelectFile($event,false)" (click)="onClick($event)">
    </label>
  </div>
  <p *ngIf="!videos || videos.length == 0" class="self-center m-0 text-sm text-center h w-60">
    Allow file types are MP4 or FLV. You can upload maximum 10mb file.
  </p>

  <ng-container *ngFor="let video of videos; let i = index;">
    <div class="relative self-center">
      <img [src]="video" class="rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
      <i class="absolute bg-white rounded-full cursor-pointer -top-1 -right-1 fa fa-times-circle" (click)="clearImage(i)"></i>
    </div>
  </ng-container>



</div>
<div class="px-8 py-5 shadow-sm min-h-64 2xl:h-88 card card-custom 3xl:h-116">
  <label class="font-medium text-black">Images</label>
  <label *ngIf="multiples.length > 0" class="mt-1 text-sm text-gray-400 form-label"> Photos {{multiples.length}}/10. You can add maximum 10 images</label>
  <div *ngIf="multiples.length == 0" class="flex flex-col justify-center h-full">
    <div class="self-center my-4 image-input image-input-outline image-upload">
      <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
      <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
        <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20"
          style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"
            src="../../../../../assets/media/icons/images.svg"></span>
        <input class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20" type="file" accept=".png, .jpg, .jpeg"
          (change)="onSelectFile($event,true)" (click)="onClick($event)" multiple>
      </label>
    </div>
    <p  class="self-center m-0 text-sm text-center h w-60">
      Allow file types are png or jpeg. You can add maximum 10 images
    </p>
  </div>

  <div #rowLayout id="drop-list-main" cdkDropListGroup class="flex flex-wrap p-4 border border-solid rounded-2xl md:max-h-40 md:overflow-y-auto 2xl:max-h-full" style="gap: 6px;" data-max-image="10" *ngIf="multiples.length > 0">

    <ng-container *ngIf="multiples && multiples.length>0">
      <div fxLayout="row" *ngFor="let itemsRow of getItemsTable();let j = index" cdkDropList
        cdkDropListOrientation="horizontal" [id]="'DropZone'+j" [cdkDropListData]="itemsRow"
        (cdkDropListDropped)="reorderDroppedItem($event,j)">
        <div *ngFor="let media of itemsRow;let i = index" cdkDrag class="flex gap-1.5"
          (cdkDragStarted)="onDragStartedDropZone(j,i)"
          [class.lastindex]="(columnSize-1==i)">
          <div class="drag-placeholder" *cdkDragPlaceholder></div>
            <img [src]="media" class="mb-1 mr-1 rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
        </div>
      </div>
    </ng-container>

    <!-- <ng-container *ngFor="let multiple of multiples; let i = index;">
      <div class="relative self-center">
        <img [src]="multiple" class="rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
        <i class="absolute bg-white rounded-full cursor-pointer -top-1 -right-1 fa fa-times-circle" (click)="clearImage(i)"></i>
      </div>
    </ng-container> -->
    <div *ngIf="multiples.length < 10" class="relative">
      <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
      <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
        <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20" style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"  src="../../../../../assets/media/icons/more-images.svg"></span>
        <input class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20" type="file" accept=".png, .jpg, .jpeg" (change)="onSelectFile($event,true)" (click)="onClick($event)" multiple>
      </label>
    </div>
 </div>

</div>
<div class="justify-center shadow-sm min-h-14 2xl:h-20 card card-custom">
  <button [disabled]=" (dealForm.invalid || urls.length == 0)" (click)="nextClick.emit('')" class="self-center w-24 text-white rounded-lg h-9 2xl:h-12 bg-primary-500">Next</button>
</div>
  </div>
</div>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
      <span  class="fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
        {{ message }}
      </span>
  </ng-container>
</ng-template>
