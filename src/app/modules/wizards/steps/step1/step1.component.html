<app-side-drawer></app-side-drawer>

<!--Title/ Header-->
<!--Card for Creating Deal-->
<div class="flex flex-col w-full h-auto gap-2 md:flex-row">
  <div class="flex justify-center w-full p-6 shadow-sm md:overflow-y-auto card card-custom">
      <form class="self-center form row max-w-124 2xl:max-w-128" [formGroup]="dealForm">
        <div class="mb-6 lg:text-center">
          <h1 class="mt-2 mb-2 text-lg text-center md:text-xl xl:text-2xl 2xl:text-3xl 3xl:text-4xl">Let's set up your deal.</h1>
          <div class="text-xs font-medium text-center text-primary-400 md:text-sm xl:text-base 3xl:text-lg">First impression matters! Let's make sure your deal stands out in our galleries.</div>
        </div>
        <!--Form-->
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Where should this deal appear?</label>
          <div #myDrop="ngbDropdown" ngbDropdown class="w-full rounded-lg d-inline-block">
            <button [disabled]="disableCategory == true" type="button" class="w-full text-xs text-left btn text-font-gray-600" [class.open]="myDrop.isOpen()" id="dropdownBasic1"
            ngbDropdownToggle>{{selectedcategory?.subCategoryName || '-Select'}}</button>
            <div class="w-full dropdown-menu" ngbDropdownMenu aria-labelledby="dropdownBasic1">
              <ng-container *ngFor="let category of categoryList" >
                <label>{{category.categoryName}}</label>
                <ng-container *ngFor="let subCategory of category.subCategories" >
                  <button ngbDropdownItem [class.selected]="selectedcategory?.subCategoryName == subCategory.subCategoryName" (click)="ChangeSelectedCategory(subCategory)">{{subCategory.subCategoryName}}</button>
                </ng-container>
              </ng-container>
            </div>
          </div>
          <!-- <input appTrim type="text " class="text-sm font-thin form-control" formControlName="subCategory" name="subCategory" placeholder="Select subCategory of your deal"
          > -->
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'sub-category is required',
            control: dealForm.controls['subCategory']
          }">
          </ng-container>
        </div>
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Deal header</label>
          <input maxlength="16" appTrim type="text " class="text-sm font-thin form-control" formControlName="dealHeader" name="dealHeader" placeholder="Enter title of your deal"
          [ngClass]="{
            'is-invalid': f['dealHeader'].invalid && f['dealHeader'].touched,
            'is-valid': f['dealHeader'].valid}">
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Deal title is required',
            control: dealForm.controls['dealHeader']
          }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Title should at least be 3 characters',
              control: dealForm.controls['dealHeader']
            }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: dealForm.controls['dealHeader']
          }">
          </ng-container>
        </div>
        <div class="h-90px fv-row 2xl:h-26">
          <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Deal sub-header</label>
          <input maxlength="150" appTrim type="text " class="text-sm font-thin form-control" formControlName="subTitle" name="subTitle" placeholder="Enter subtitle of your deal"
          [ngClass]="{
            'is-invalid': f['subTitle'].invalid && f['subTitle'].touched,
            'is-valid': f['subTitle'].valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Subtitle is required',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Subtitle should at least be 3 characters',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: dealForm.controls['subTitle']
          }">
            </ng-container>
        </div>
        <div class="mb-4 fv-row">
              <label class="mb-4 text-sm 2xl:text-base 2xl:mb-2 form-label">Upload your pictures</label>
              <!-- <label *ngIf="multiples.length > 0" class="mt-1 text-sm text-gray-400 form-label"> Photos {{multiples.length}}/10. You can add maximum 10 images</label> -->
              <div (files)="onSelectFile($event,true)" appDragAnDropUpload class="rounded-xl min-h-40 pictures-drop-container">
                <div *ngIf="multiples.length == 0" class="flex flex-col justify-center h-full">
                  <div class="self-center my-4 image-input image-input-outline image-upload">
                    <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                    <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
                      <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20"
                        style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"
                          src="../../../../../assets/media/icons/images.svg"></span>
                      <input #imgInput class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20" type="file" accept=".png, .jpg, .jpeg"
                        (change)="onSelectFile($event,true)" multiple>
                    </label>
                  </div>
                  <p  class="self-center m-0 text-sm text-center h w-60">
                    Drag and Drop or <a  class="underline s text-primary-500" (click)="imgInput.click()">Browse</a>
                  </p>
                  <p  class="self-center m-0 mt-3 text-xs text-center text-gray-500">
                    Allow file types are png or jpeg. You can add maximum 10 images
                  </p>
                </div>

                <div  cdkDropListGroup class="p-4 overflow-hidden md:max-h-40 md:overflow-y-auto 2xl:max-h-full" data-max-image="10" *ngIf="multiples.length > 0">
                <div id="drop-list-main" class="flex flex-wrap w-full h-full" data-max-image="10" *ngIf="multiples.length > 0">

                  <ng-container *ngIf="multiples && multiples.length>0">
                    <div fxLayout="row" *ngFor="let itemsRow of getItemsTable();let j = index" cdkDropList
                      cdkDropListOrientation="horizontal" [id]="'DropZone'+j"   [ngClass]="{' h-15 2xl:h-22 overflow-hidden dropZone_Reorder': true}"  [cdkDropListData]="itemsRow"
                      (cdkDropListDropped)="reorderDroppedItem($event,j)">
                      <ng-container *ngFor="let media of itemsRow;let i = index;last as last;first as first">
                        <div cdkDrag class="relative" [class.lastindex]="last && dragIndex !=j" (cdkDragStarted)="onDragStartedDropZone(j,i)">
                          <div class="drag-placeholder" [ngStyle]="{'width': last && dragIndex !=j ? '0 !important' : '' }" style="" *cdkDragPlaceholder></div>
                          <img [src]="media" class="m-0.5 2xl:m-1 rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
                          <i class="absolute top-0 right-0 bg-white rounded-full cursor-pointer fa fa-times-circle" (click)="clearImage(j,i)"></i>
                        </div>
                      </ng-container>
                    </div>
                  </ng-container>

                  <!-- <ng-container *ngFor="let multiple of multiples; let i = index;">
                    <div class="relative self-center">
                      <img [src]="multiple" class="rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
                      <i class="absolute bg-white rounded-full cursor-pointer -top-1 -right-1 fa fa-times-circle" (click)="clearImage(i)"></i>
                    </div>
                  </ng-container> -->
                  <div *ngIf="multiples.length < 10" class="relative">
                    <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                    <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
                      <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20 m-0.5 ml-1 2xl:m-1 2xl:ml-2" style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"  src="../../../../../assets/media/icons/more-images.svg"></span>
                      <input class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20 m-0.5 ml-1 2xl:m-1 2xl:ml-2" type="file" accept=".png, .jpg, .jpeg" (change)="onSelectFile($event,true)" (click)="onClick($event)" multiple>
                    </label>
                  </div>
               </div>
               </div>
              </div>
        </div>
        <div class="fv-row">
          <label class="mb-4 text-sm 2xl:text-base 2xl:mb-2 form-label">Upload your Video</label>
          <div class="rounded-xl min-h-40 video-container">

          <div (files)="onSelectFile($event,false)" appDragAnDropUpload *ngIf="!videos || videos.length == 0" class="flex flex-col justify-center h-full">
            <div class="self-center my-4 image-input image-input-outline image-upload">
              <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none; opacity: 0.8;">
              </div>
              <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
                <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20"
                  style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"
                    src="../../../../../assets/media/icons/video-play.svg"></span>
                <input #videoInput class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20" type="file"
                  accept="video/mp4 , .FLV">
              </label>
            </div>
            <ng-container *ngIf="!videos || videos.length == 0">
              <p class="self-center m-0 text-sm text-center h w-60">
                Drag and Drop or <a  class="underline s text-primary-500" (click)="videoInput.click()">Browse</a>
              </p>
              <p class="self-center m-0 mt-3 text-xs text-center text-gray-500">
                Allow file types are MP4 or FLV. You can upload maximum 10mb file.
              </p>
            </ng-container>
          </div>

          <ng-container *ngFor="let video of videos; let i = index;">
            <div class="relative self-center">
              <video [src]="video" class="rounded-lg w-14 h-14 2xl:h-20 2xl:w-20"></video>
              <!-- <i class="absolute bg-white rounded-full cursor-pointer -top-1 -right-1 fa fa-times-circle" (click)="clearImage(i)"></i> -->
            </div>
          </ng-container>
        </div>
        </div>


        <div class="flex justify-center mt-8 min-h-14 2xl:h-20">
          <button [disabled]=" (dealForm.invalid || urls.length == 0)" (click)="nextClick.emit('')" class="self-center w-32 text-sm text-white rounded-lg h-9 2xl:h-12 bg-primary-500">Save & Next</button>
        </div>

      </form>
  </div>
</div>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
      <span  class="fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
        {{ message }}
      </span>
  </ng-container>
</ng-template>
