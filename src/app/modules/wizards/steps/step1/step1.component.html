<!-- <app-vertical></app-vertical> -->

<!--Title/ Header-->
<!--Card for Creating Deal-->
<div class="flex flex-col w-full h-auto gap-2 mt-9 md:flex-row">
  <div class="flex justify-center w-full p-6 shadow-sm md:overflow-y-auto card card-custom">
      <form class="self-center form max-w-124 2xl:max-w-128 3xl:max-w-135" [formGroup]="dealForm">
        <div class="mb-9 lg:text-center">
          <h1 class="mt-1 mb-2.5 text-lg text-center md:text-xl xl:text-2xxl xl:font-semibold 2xl:text-3xl 3xl:text-4xl">Let's set up your deal.</h1>
          <div class="text-xs font-medium text-center text-primary-400 md:text-sm xl:text-base 3xl:text-lg">First impression matters! Let's make sure your deal stands out in our galleries.</div>
        </div>
        <!--Form-->
        <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Where should this deal appear?</label>
            <div #myDrop="ngbDropdown" ngbDropdown class="w-full rounded-lg d-inline-block">
              <ng-container *ngIf="!editDealCheck">
                <button [disabled]="disableCategory == true" type="button" class="relative w-full px-4 text-base text-left text-black btn" [class.open]="myDrop.isOpen()" id="dropdownBasic1"
                  ngbDropdownToggle>{{selectedcategory?.subCategoryName || '-Select'}}
                  <i [ngClass]="myDrop.isOpen() ? 'fas fa-caret-up fa-lg' : 'fas fa-caret-down fa-lg'" class="absolute text-black fas fa-caret-down fa-lg top-6 right-2"></i>
                </button>
              </ng-container>
              <ng-container *ngIf="editDealCheck">
                <button id="dropdownBasic1" ngbDropdownToggle (click)="openDropDown()" type="button" class="relative w-full px-4 text-base text-left text-black btn">{{categoryEdit}}</button>
                <i (click)="openDropDown()" class="absolute text-black cursor-pointer fas fa-caret-down top-5 right-3"></i>
              </ng-container>
              <div class="w-full dropdown-menu" ngbDropdownMenu aria-labelledby="dropdownBasic1">
                <ng-container *ngIf="categoryList">
                  <ng-container *ngFor="let category of (categoryList | async)">
                    <label>{{category.categoryName}}</label>
                    <ng-container *ngFor="let subCategory of category.subCategories" >
                      <ng-container *ngIf="subCategory.subCategoryName == 'Metaverse(Coming soon)'; else notDisabled">
                        <button [disabled]="true" ngbDropdownItem [class.selected]="selectedcategory?._id == subCategory._id">{{subCategory.subCategoryName}}</button>
                      </ng-container>
                      <ng-template #notDisabled>
                        <button type="button" ngbDropdownItem [class.selected]="selectedcategory?._id == subCategory._id" (click)="ChangeSelectedCategory(subCategory)">{{subCategory.subCategoryName}}</button>
                      </ng-template>
                    </ng-container>
                  </ng-container>
                </ng-container>

                <ng-container *ngIf="!categoryList">
                  <div class="flex flex-col items-center py-4 mx-auto align-middle justify center">
                    <mat-spinner [diameter]="25"></mat-spinner>
                  </div>
                </ng-container>
              </div>
            </div>

          <!-- <ng-container *ngIf="editDealCheck">
            <div ngbDropdown class="w-full rounded-lg d-inline-block">
              <button id="dropdownBasic1" ngbDropdownToggle (click)="openDropDown()" type="button" class="w-full px-4 text-base text-left text-black btn">{{categoryEdit}}</button>
            </div>
          </ng-container> -->
          <!-- <input appTrim type="text " class="text-sm font-thin form-control" formControlName="subCategory" name="subCategory" placeholder="Select subCategory of your deal"
          > -->
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Category is required',
            control: dealForm.controls['subCategory']
          }">
          </ng-container>
        </div>
        <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Deal title</label>
          <input maxlength="100" appTrim type="text " class="text-base font-normal text-black form-control" formControlName="dealHeader" name="dealHeader" placeholder="Enter title of your deal"
          [ngClass]="{
            'is-invalid': f['dealHeader'].invalid && f['dealHeader'].touched,
            'is-valid': f['dealHeader'].valid}">
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Deal title is required',
            control: dealForm.controls['dealHeader']
          }">
          </ng-container>
          <ng-container *ngIf="f['dealHeader']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Deal title should at least be 3 characters',
              control: dealForm.controls['dealHeader']
            }">
          </ng-container>
          <ng-container *ngIf="!f['dealHeader']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Special characters are not allowed',
            control: dealForm.controls['dealHeader']
          }">
          </ng-container>
        </div>
        <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Deal sub-title</label>
          <input maxlength="200" appTrim type="text " class="text-base font-normal text-black form-control" formControlName="subTitle" name="subTitle" placeholder="Enter subtitle of your deal"
          [ngClass]="{
            'is-invalid': f['subTitle'].invalid && f['subTitle'].touched,
            'is-valid': f['subTitle'].valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal sub-title is required',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container *ngIf="f['subTitle']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Deal sub-title should at least be 3 characters',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
            <ng-container *ngIf="!f['subTitle']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'pattern',
              message: 'Special characters are not allowed',
              control: dealForm.controls['subTitle']
            }">
            </ng-container>
        </div>
        <div class="mb-4 fv-row">
          <label class="mb-4 text-sm 2xl:text-base form-label">Upload your pictures</label>
          <!-- <label *ngIf="multiples.length > 0" class="mt-1 text-sm text-gray-400 form-label"> Photos {{multiples.length}}/10. You can add maximum 10 images</label> -->
          <div (files)="onSelectFile($event,true)" appDragAnDropUpload class="rounded-xl min-h-43 pictures-drop-container">
            <div *ngIf="multiples.length == 0 && showImageSkeleton == false" class="flex flex-col justify-center h-full">
              <div class="self-center mt-6 mb-3 image-input image-input-outline image-upload">
                <div class="w-18 h-18 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                <label class="absolute top-0 w-18 h-18 btn btn-xs btn-icon btn-hover-text-primary">
                  <span class="absolute top-0 flex items-center justify-center w-18 h-18" style="color: rgb(179, 179, 179); font-size: 30px">
                    <img class="w-18 h-18 "src="../../../../../assets/media/icons/images.svg">
                  </span>
                  <input #imgInput class="absolute top-0 cursor-pointer w-18 h-18 " type="file" accept=".png, .jpg, .jpeg" (change)="onSelectFile($event,true)" multiple>
                </label>
              </div>
              <p class="self-center m-0 text-sm text-center h w-60">
                Drag and Drop or <a class="underline cursor-pointer text-primary-500" (click)="imgInput.click()">Browse</a>
              </p>
              <p  class="self-center m-0 mt-2 text-xs text-center text-gray-500">
                Allowed file types are PNG or JPEG. You can add maximum 10 images
              </p>
            </div>

            <div *ngIf="showImageSkeleton == true" class="flex flex-col justify-center h-full">
              <div class="self-center mt-6 mb-3 image-input image-input-outline image-upload">
                <div class="w-18 h-18 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                  <span class="absolute flex items-center justify-center top-2 w-18 h-18" style="color: rgb(179, 179, 179); font-size: 30px">
                    <mat-spinner [diameter]="45"></mat-spinner>
                  </span>
                  <p class="self-center m-0 mt-2 text-xs text-center text-gray-500">
                    Loading images...
                  </p>
              </div>
            </div>

            <div cdkDropListGroup class="p-4 overflow-hidden md:max-h-40 md:overflow-y-auto 2xl:max-h-full" data-max-image="10" *ngIf="multiples.length > 0">
              <div id="drop-list-main" class="flex flex-wrap w-full h-full" data-max-image="10" *ngIf="multiples.length > 0">
                <ng-container *ngIf="multiples && multiples.length > 0">
                  <div fxLayout="row" *ngFor="let itemsRow of getItemsTable(); let j = index" cdkDropList
                    cdkDropListOrientation="horizontal" [id]="'DropZone'+j"  [ngClass]="{' h-15 2xl:h-22 overflow-hidden dropZone_Reorder': true}"  [cdkDropListData]="itemsRow"
                    (cdkDropListDropped)="reorderDroppedItem($event,j)">
                    <ng-container *ngFor="let media of itemsRow; let i = index; last as last; first as first">
                      <div cdkDrag class="relative" [class.lastindex]="last && dragIndex !=j" (cdkDragStarted)="onDragStartedDropZone(j,i)">
                        <div class="drag-placeholder" [ngStyle]="{'width': last && dragIndex !=j ? '0 !important' : '' }" style="" *cdkDragPlaceholder></div>
                        <img [src]="media" class="m-0.5 2xl:m-1 rounded-lg w-14 h-14 2xl:h-20 2xl:w-20">
                        <i class="absolute top-0 right-0 bg-white rounded-full cursor-pointer fa fa-times-circle" (click)="clearImage(j,i)"></i>
                      </div>
                    </ng-container>
                  </div>
                </ng-container>

                <div *ngIf="multiples.length < 10" class="relative">
                  <div class="w-14 h-14 2xl:h-20 2xl:w-20 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                  <label class="absolute top-0 w-14 h-14 2xl:h-20 2xl:w-20 btn btn-xs btn-icon btn-hover-text-primary">
                    <span class="absolute top-0 flex items-center justify-center w-14 h-14 2xl:h-20 2xl:w-20 m-0.5 ml-1 2xl:m-1 2xl:ml-2" style="color: rgb(179, 179, 179); font-size: 30px"><img class="w-14 h-14 2xl:h-20 2xl:w-20"  src="../../../../../assets/media/icons/more-images.svg"></span>
                    <input class="absolute top-0 cursor-pointer w-14 h-14 2xl:h-20 2xl:w-20 m-0.5 ml-1 2xl:m-1 2xl:ml-2" type="file" accept=".png, .jpg, .jpeg" (change)="onSelectFile($event,true)" (click)="onClick($event)" multiple>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <ng-container *ngIf="submitClick && this.urls.length == 0">
            <div class="w-full fv-plugins-message-container text-xxs 2xl:text-xs">
              <span  class="fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
                At least one image is required
              </span>
            </div>
          </ng-container>
        </div>

        <div class="fv-row">
          <label class="mb-4 text-sm 2xl:text-base 2xl:mb-2 form-label">Upload your video</label>
          <div class="rounded-xl min-h-43 video-container" *ngIf="showImageSkeleton == false">
            <div (files)="onSelectVideo($event)" appDragAnDropUpload *ngIf="!url && !editUrl && loadingVideo == false" class="flex flex-col justify-center h-full">
              <div class="self-center mt-6 mb-3 image-input image-input-outline image-upload">
                <div class="w-18 h-18 image-input-wrapper" style="box-shadow: none; opacity: 0.8;">
                </div>
                <label class="absolute top-0 w-18 h-18 btn btn-xs btn-icon btn-hover-text-primary">
                  <span class="absolute top-0 flex items-center justify-center w-18 h-18 "
                    style="color: rgb(179, 179, 179); font-size: 30px">
                    <img class="w-18 h-18 "
                    src="../../../../../assets/media/icons/video-play.svg"></span>
                  <input #videoInput class="absolute top-0 cursor-pointer w-18 h-18 " type="file"
                    accept="video/mp4 , .FLV" (change)="onSelectVideo($event)" (click)="onClick($event)">
                </label>
              </div>
              <ng-container *ngIf="!url && loadingVideo == false">
                <p class="self-center m-0 text-sm text-center h w-60">
                  Drag and Drop or <a  class="underline cursor-pointer text-primary-500" (click)="videoInput.click()">Browse</a>
                </p>
                <p class="self-center m-0 mt-2 text-xs text-center text-gray-500">
                  Allowed file types are MP4 or FLV. You can upload maximum 10MB file.
                </p>
              </ng-container>
            </div>

            <ng-container *ngIf="url && !editUrl && loadingVideo == false">
              <div class="relative self-center m-4" style="width: fit-content;">
                <img [src]="url" class="object-cover rounded-lg w-36 h-22 2xl:h-26 2xl:w-52">
                <i class="absolute -top-1 -right-0.5 bg-white rounded-full cursor-pointer fa fa-times-circle" (click)="clearVideo()"></i>
              </div>
            </ng-container>

            <ng-container *ngIf="!url && !editUrl && loadingVideo == true">
              <div class="flex m-4 justify-starts" style="width: fit-content;">
                <span class="px-24 py-12 bg-gray-300 rounded-lg animate-pulse">
                  <mat-spinner [diameter]="30"></mat-spinner>
                </span>
              </div>
            </ng-container>

            <ng-container *ngIf="!url && editUrl && loadingVideo == false">
                <div class="relative self-center m-4" style="width: fit-content;">
                  <video [src]="editUrl" class="object-cover rounded-lg w-36 h-22 2xl:h-26 2xl:w-52"></video>
                  <i class="absolute -top-1 -right-0.5 bg-white rounded-full cursor-pointer fa fa-times-circle" (click)="clearVideo()"></i>
                </div>
            </ng-container>
          </div>

          <div class="rounded-xl min-h-43 video-container" *ngIf="showImageSkeleton == true">
            <div class="flex flex-col justify-center h-full">
              <div class="self-center mt-6 mb-3 image-input image-input-outline image-upload">
                <div class="w-18 h-18 image-input-wrapper" style="box-shadow: none;  opacity: 0.8;"></div>
                  <span class="absolute flex items-center justify-center top-2 w-18 h-18" style="color: rgb(179, 179, 179); font-size: 30px">
                    <mat-spinner [diameter]="45"></mat-spinner>
                  </span>
                  <p class="self-center m-0 mt-2 text-xs text-center text-gray-500">
                    Loading video...
                  </p>
              </div>
            </div>
          </div>
        </div>


        <div class="flex justify-center mt-8 min-h-14 2xl:h-20">
          <button [ngClass]="loadingVideo == true ? 'opacity-50': 'opacity-100'" [disabled]="loadingVideo == true" (click)="saveDraftOne();" class="self-center w-32 text-sm text-white rounded-lg h-9 2xl:h-12 bg-primary-500">Save & next</button>
        </div>

      </form>
  </div>
</div>

<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
    <div class="w-full fv-plugins-message-container text-xxs 2xl:text-xs">
      <span  class="fv-help-block text-xxs 2xl:text-xs 2xl:mb-2" role="alert">
        {{ message }}
      </span>
    </div>
  </ng-container>
</ng-template>

<app-media-progress></app-media-progress>
