<!--Title/ Header-->
<div class="mb-6 lg:text-center">
  <h1 class="mt-2 mb-2 text-lg text-center md:text-xl xl:mt-4 xl:text-2xl 3xl:text-3xl">Let's get the numbers right</h1>
  <div class="text-xs font-thin text-center text-primary-400 md:text-sm xl:text-base 3xl:text-lg">Lets make sure our customers realize how exceptional this deal is!</div>
</div>
<!--Card for Viewing Deal-->
<div class="flex flex-col-reverse w-full gap-2 md:h-136 md:flex-row">
  <div class="w-full p-6 overflow-y-auto shadow-sm md:p-4 xl:p-6 md:max-w-50 lg:max-w-60 xl:max-w-68 add-voucher card card-custom">
    <div class="p-0 modal-body">
        <div class="flex justify-between 3xl:justify-evenly">
          <div class="w-full text-sm font-semibold md:text-base">Provide your voucher details.
          </div>
        </div>
      <div>
        <form class="mt-2 form" [formGroup]="vouchers">
          <div class="h-90px fv-row 2xl:h-26">
            <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Subtitle</label>
              <input maxlength="16" appTrim type="text" class="form-control" formControlName="subTitle" name="subTitle"
              [ngClass]="{
              'is-invalid': vouchers.controls['subTitle']?.invalid && vouchers.controls['subTitle']?.touched,
              'is-valid': vouchers.controls['subTitle']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Subtitle is required',
              control: vouchers.controls['subTitle']
            }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Subtitle should at least be 3 characters',
              control: vouchers.controls['subTitle']
            }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: vouchers.controls['subTitle']
          }">
          </ng-container>
          </div>

          <div class="h-90px fv-row 2xl:h-26">
            <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Original Price</label>
              <span class="absolute flex items-center mt-2 ml-1"><i style="font-size:10px;" class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-success"></i></span>
              <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="originalPrice"
              [ngClass]="{
              'is-invalid':  vouchers.controls['originalPrice']?.invalid &&  vouchers.controls['originalPrice']?.touched,
              'is-valid':  vouchers.controls['originalPrice']?.valid}">
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Original Price is required',
                control: vouchers.controls['originalPrice']
              }">
              </ng-container>
            </div>

            <div class="h-90px fv-row 2xl:h-26">
            <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Deal Price</label>
              <span class="absolute flex items-center mt-2 ml-1"><i style="font-size:10px;" class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-danger"></i></span>
              <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="dealPrice" name="dealPrice"
              [ngClass]="{
              'is-invalid': vouchers.controls['dealPrice']?.invalid && vouchers.controls['dealPrice']?.touched,
              'is-valid': vouchers.controls['dealPrice']?.valid}">
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Deal Price is required',
                control: vouchers.controls['dealPrice']
              }">
              </ng-container>
            <div class="text-xs text-danger"
            *ngIf="vouchers.controls['dealPrice']?.errors?.['confirmedValidator']">
              The deal price cannot exceed the original price
              </div>
            </div>

            <div class="h-90px fv-row 2xl:h-26">
            <label class="mb-1 text-sm 2xl:text-base 2xl:mb-2 form-label">Number of Available Vouchers</label>
              <div class="flex items-center justify-between h-8 border-2 border-white rounded-sm w-28">
                <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md" (click)="handleMinus()">-</button>
                <input maxlength="4" appNumbersOnly type="text" style="min-height:25px !important"  class="w-12 py-0.5 text-xs text-center rounded-md form-control" placeholder="0" formControlName="numberOfVouchers" name="numberOfVouchers">
                <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md" (click)="handlePlus()">+</button>
              </div>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Please specify number of vouchers',
                control: vouchers.controls['numberOfVouchers']
              }">
            </ng-container>
          </div>
          <div class="flex justify-center">
            <button type="button" class="w-20 p-0 text-white h-9 btn btn-dark" (click)="calculateDiscount()" [disabled]="vouchers.invalid">Add</button>
          </div>

        </form>
      </div>
    </div>
  </div>
<div class="flex flex-col w-full gap-2 shadow-sm card card-custom">
  <div class="flex flex-col md:flex-row">
    <div class="flex-grow">
      <div class="flex flex-wrap flex-shrink p-4 lg:px-11 lg:py-6" style="max-width: 430px;">
        <div class="flex flex-col w-full">
          <label class="w-full mb-1 text-xs font-semibold text-justify md:text-base">{{data.title}}</label>
          <label class="w-full mb-1 text-xs text-justify text-gray-400 md:text-sm">{{data.subTitle | truncate: 50}}</label>
          <div class="w-full text-xs text-gray-700">
            <i class="mr-2 text-green-400 fas fa-map-marker-alt fa-lg"></i>
            {{address}}
          </div>
          <ng-container *ngFor="let image of images; let i = index">
            <ng-container *ngIf="i == 0">
              <div class="w-full h-40 mt-2 mb-3 main-img-container xl:h-48">
                <img class="object-contain h-40 card-img-top rounded-bottom" [src]="image">
              </div>
            </ng-container>
          </ng-container>
            <!--loop for images goes here-->
          <div class="flex-row justify-between w-9 h-9 card">
            <ng-container *ngFor="let image of images; let i = index;">
              <img class="mr-1 rounded-sm" [src]="image" *ngIf="i > 0">
            </ng-container>
          </div>
          <div class="mt-3 text-sm text-black form-label fw-bolder md:text-base">Description</div>
          <p class="w-full mr-6 text-justify text-gray-400 fs-8">{{data.description | truncate: 80}}</p>
        </div>
      </div>
    </div>
    <div class="flex-wrap min-w-full p-4 xl:p-6 voucher md:min-w-48">
      <ng-container *ngIf="subDeals.length == 0">
        <div class="flex flex-col items-center justify-center pb-4 mt-16 text-center align-middle h-1/2">
          <img src="../../../../../assets/media/logos/giftbox.svg" class="mb-3 opacity-20 xl:w-28 xl:h-28 w-14 h-14">
          <p class="text-xs lg:text-sm">Your sub voucher details will appear here.</p>
        </div>
      </ng-container>
      <ng-container *ngIf="subDeals.length > 0">
        <div class="pt-6 lg:h-72 lg:overflow-x-scroll">
          <ng-container *ngFor="let singleDeal of subDeals;let i = index">
            <div class="text-sm font-thin text-justify lg:text-base lg:justify-start">{{singleDeal?.subTitle}}</div>
            <div class="flex items-center justify-between mb-3 font-thin flex-nowrap">
              <i class="text-xs text-gray-600 line-through fas fa-dollar-sign lg:text-base">{{singleDeal?.originalPrice}}</i>
              <i class="text-xs text-green-400 fas fa-dollar-sign lg:text-base">{{singleDeal?.dealPrice}}</i>
              <i style="font-style: normal;" class="text-xs text-red-500 lg:text-base fw-bolder">{{singleDeal?.discountPercentage}}% off</i>
            </div>
            <div>
              <i class="p-1 mr-2 text-yellow-600 bg-yellow-300 cursor-pointer fas fa-pencil-alt fa-xs rounded-circle" (click)="edit(i)"></i>
              <i class="p-1 text-red-700 bg-red-300 cursor-pointer fas fa-trash fa-xs rounded-circle" (click)="deleteDeal(i)"></i>
            </div>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </div>

</div>
</div>


<!--Create Deal Modal-->

<app-reusable-modal #modal [modalConfig]="modalConfig">
  <div class="p-0 modal-body">
    <div class="flex justify-end p-0 m-0">
      <button class="p-3 m-2 btn btn-sm btn-icon btn-bg-light btn-active-color-primary" (click)="closeModal()" style="
       border-radius: 100%;">
        <span class="text-gray-800 fs-6">x</span>
      </button>
    </div>
    <div>
      <form class="px-6 mt-2 md:px-11 form" [formGroup]="vouchers">
        <div class="mb-3 form-group">
          <label class="mb-2.5 text-sm">Subtitle</label>
          <div class="input-group">
            <input maxlength="16" appTrim type="text" class="form-control" formControlName="subTitle" name="subTitle"
            [ngClass]="{
            'is-invalid': vouchers.controls['subTitle']?.invalid && vouchers.controls['subTitle']?.touched,
            'is-valid': vouchers.controls['subTitle']?.valid}"
          >
          </div>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Deal Subtitle is required',
            control: vouchers.controls['subTitle']
          }">
        </ng-container>
        <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'minlength',
            message: 'Subtitle should at least be 3 characters',
            control: vouchers.controls['subTitle']
          }">
        </ng-container>
        <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
          validation: 'pattern',
          message: 'Only alphabets are allowed',
          control: vouchers.controls['subTitle']
        }">
        </ng-container>
        </div>

        <div class="mb-3 form-group">
          <label class="mb-2.5 text-sm">Original Price</label>
          <div class="input-icon">
            <span class="mt-2.5 ml-1 absolute flex items-center"><i class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-success"></i></span>
            <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="originalPrice"
            [ngClass]="{
            'is-invalid':  vouchers.controls['originalPrice']?.invalid &&  vouchers.controls['originalPrice']?.touched,
            'is-valid':  vouchers.controls['originalPrice']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Original Price is required',
              control: vouchers.controls['originalPrice']
            }">
            </ng-container>
          </div>
          </div>

          <div class="form-group">
          <label class="mb-2.5 text-sm">Deal Price</label>
          <div class="input-icon">
            <span class="mt-2.5 ml-1 absolute flex items-center"><i class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-danger"></i></span>
            <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="dealPrice" name="dealPrice"
            [ngClass]="{
            'is-invalid': vouchers.controls['dealPrice']?.invalid && vouchers.controls['dealPrice']?.touched,
            'is-valid': vouchers.controls['dealPrice']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Price is required',
              control: vouchers.controls['dealPrice']
            }">
            </ng-container>
          </div>
          <div class="text-xs text-danger"
          *ngIf="vouchers.controls['dealPrice']?.errors?.['confirmedValidator']">
            The deal price cannot exceed the original price
            </div>
          </div>

          <!-- <div class="form-group">
          <label class="mt-3 mb-3 text-sm">Description</label>
          <div class="input-icon">
            <textarea maxlength="100" appTrim class="form-control" rows="5" formControlName="details" name="details"
            [ngClass]="{
            'is-invalid': vouchers.controls['details']?.invalid && vouchers.controls['details']?.touched,
            'is-valid': vouchers.controls['details']?.valid}">
          </textarea>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Description is required',
              control: vouchers.controls['details']
            }">
            </ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Description should at least be 16 characters',
              control: vouchers.controls['details']
            }">
          </ng-container>
          </div>
        </div> -->

          <div class="form-group">
          <label class="mt-3 mb-3 text-sm">Number of Available Vouchers</label>
          <div class="relative">
            <div class="flex w-2/5 h-8 border-2 border-white rounded-sm">
              <button class="w-20 h-full mr-2 text-xl font-bold text-gray-500 bg-gray-200 rounded-md" (click)="handleMinus()">-</button>
              <input maxlength="4" appNumbersOnly type="text" style="border-width: 1px;" class="w-full text-xs text-center rounded-md form-control" placeholder="0" formControlName="numberOfVouchers" name="numberOfVouchers">
              <button class="w-20 h-full ml-2 text-xl font-bold text-gray-500 bg-gray-200 rounded-md" (click)="handlePlus()">+</button>
            </div>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Please specify number of vouchers',
              control: vouchers.controls['numberOfVouchers']
            }">
          </ng-container>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="text-white btn btn-dark" (click)="calculateDiscount()" [disabled]="vouchers.invalid">Save</button>
  </div>
</app-reusable-modal>


<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control?.hasError(validation) && (control.dirty || control.touched)">
    <div class="fv-plugins-message-container">
      <div class="text-xs fv-help-block">
        {{ message }}
      </div>
    </div>
  </ng-container>
</ng-template>
