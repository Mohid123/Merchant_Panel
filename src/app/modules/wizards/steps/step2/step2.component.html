<!--Card for Viewing Deal-->
<div class="flex flex-col-reverse w-full gap-2 main-con md:h-136 md:flex-row">
  <div class="w-full p-6 overflow-y-auto shadow-sm md:p-4 xl:p-6 add-voucher card card-custom">
    <div class="flex flex-col self-center p-0 modal-body max-w-135">
      <!--Title/ Header-->
        <div class="mb-9 lg:text-center">
          <h1 class="mt-1 mb-2.5 text-lg text-center md:text-xl xl:text-2xxl xl:font-semibold 2xl:text-3xl 3xl:text-4xl">Let's create your vouchers.</h1>
          <div class="text-xs font-medium text-center text-primary-400 md:text-sm xl:text-base 3xl:text-lg">Now is the time to set up the variations of the deal you're offering.</div>
        </div>
      <div>
        <div class="flex flex-col 3xl:justify-evenly">
          <ng-container *ngIf="subDeals.length > 0">
            <div class="mt-5">
              <div class="voucher-container" *ngFor="let singleDeal of subDeals;let i = index">
                <div class="mb-3 text-base font-medium text-justify lg:text-base lg:justify-start">{{singleDeal?.subTitle}}</div>
                <div class="mb-1.5 flex items-center">
                  <i style="font-size: 10px; line-height: 24px;" class="text-gray-600 fas fa-euro-sign"></i><i style="font-style: normal;" class="mr-3 text-base text-gray-600">{{singleDeal?.originalPrice}}</i>
                  <i style="font-size: 10px; line-height: 24px;" class="text-green-400 fas fa-euro-sign"></i><i style="font-style: normal;" class="mr-3 text-base text-green-400">{{singleDeal?.dealPrice}}</i>
                  <i style="font-style: normal;" class="text-sm text-primary-400">{{singleDeal?.discountPercentage}}% off</i>
                </div>
                <div class="flex justify-between">
                  <div class="flex justify-between">
                    <p class="text-sm" style="color:#414950">
                      Number of available vouchers
                    </p>
                    <span class="bg-primary-50 rounded-md ml-4 h-6 text-primary-400 text-xs px-2.5 py-1">
                      {{singleDeal?.numberOfVouchers}}
                    </span>
                  </div>
                  <div class="flex">
                    <i class="mr-2 fas fa-pencil-alt fa-xs rounded-circle action-btn"
                      (click)="edit(i)"></i>
                    <i class="fas fa-trash fa-xs rounded-circle action-btn"
                      (click)="deleteDeal(i)"></i>
                  </div>
                </div>
              </div>
              <div class="flex items-end justify-center h-8 add-more-voucher">
                <a *ngIf="!addVoucher" class="cursor-pointer text-primery-400" (click)="addMoreVoucher()">+ Add more voucher</a>
              </div>
              <svg *ngIf="subDeals.length > 0" width="100%" height="25px">
                <line height="0.5px" x1="0" y1="13" x2="100%" y2="13" style="stroke-dasharray: 6, 6;stroke: #9BB3C8;stroke-width: 0.5px;"></line>
             </svg>
            </div>
          </ng-container>
        </div>
        <form *ngIf="addVoucher || subDeals.length == 0" class="mt-4 form" [formGroup]="vouchers">
          <div class="h-24 fv-row 2xl:h-26">
            <label class="form-label">Voucher type</label>
              <input maxlength="16" appTrim type="text" class="form-control" formControlName="subTitle" name="subTitle"
              [ngClass]="{
              'is-invalid': vouchers.controls['subTitle']?.invalid && vouchers.controls['subTitle']?.touched,
              'is-valid': vouchers.controls['subTitle']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Subtitle is required',
              control: vouchers.controls['subTitle']
            }">
          </ng-container>
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'minlength',
              message: 'Subtitle should at least be 3 characters',
              control: vouchers.controls['subTitle']
            }">
          </ng-container>
          <ng-container *ngIf="!vouchers.controls['subTitle']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'pattern',
            message: 'Only alphabets are allowed',
            control: vouchers.controls['subTitle']
          }">
          </ng-container>
          </div>

          <div class="h-24 fv-row 2xl:h-26">
            <label class="form-label">Original Price</label>
              <span class="absolute flex items-center h-11 "><i style="font-size:10px;" class="p-2 ml-2 text-white bg-gray-500 rounded fas fa-euro-sign fa-lg"></i></span>
              <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="originalPrice"
              [ngClass]="{
              'is-invalid':  vouchers.controls['originalPrice']?.invalid &&  vouchers.controls['originalPrice']?.touched,
              'is-valid':  vouchers.controls['originalPrice']?.valid}">
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Original Price is required',
                control: vouchers.controls['originalPrice']
              }">
              </ng-container>
            </div>

            <div class="h-24 fv-row 2xl:h-26">
            <label class="form-label">Deal Price</label>
              <span class="absolute flex items-center h-11"><i style="font-size:10px;" class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-success"></i></span>
              <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="dealPrice" name="dealPrice"
              [ngClass]="{
              'is-invalid': vouchers.controls['dealPrice']?.invalid && vouchers.controls['dealPrice']?.touched,
              'is-valid': vouchers.controls['dealPrice']?.valid}">
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Deal Price is required',
                control: vouchers.controls['dealPrice']
              }">
              </ng-container>
            <div class="text-xs text-danger"
            *ngIf="vouchers.controls['dealPrice']?.errors?.['confirmedValidator']">
              The deal price cannot grater then the original price
              </div>
            </div>

            <div class="h-24 mb-3 fv-row 2xl:h-26">
            <label class="form-label">Number of Available Vouchers</label>
              <div class="flex items-center mb-1.5 justify-between h-8 border-2 border-white rounded-sm w-28">
                <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md hover:text-primary-500 hover:bg-primary-100" (click)="handleMinus()">-</button>
                <input maxlength="4" appNumbersOnly type="text" style="height: 24px !important;min-height: unset;" class="w-12 py-0.5 text-xs text-center rounded-md form-control" placeholder="0" formControlName="numberOfVouchers" name="numberOfVouchers">
                <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md hover:text-primary-500 hover:bg-primary-100" (click)="handlePlus()">+</button>
              </div>
              <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Please specify number of vouchers',
                control: vouchers.controls['numberOfVouchers']
              }">
            </ng-container>
            <svg *ngIf="subDeals.length == 0" width="100%" height="25px">
              <line height="0.5px" x1="0" y1="13" x2="100%" y2="13" style="stroke-dasharray: 6, 6;stroke: #9BB3C8;stroke-width: 0.5px;"></line>
           </svg>
          </div>
          <div class="flex justify-between">
            <button *ngIf="subDeals.length == 0 " type="button" class="self-center w-24 h-10 p-0 text-xs text-gray-600 bg-gray-300 rounded-lg" (click)="prevClick.emit('')">Back</button>
            <button *ngIf="subDeals.length > 0 " type="button" class="self-center w-24 h-10 p-0 text-xs text-gray-600 bg-gray-300 rounded-lg" (click)="cancleVoucher()">Cancel</button>
            <button type="button" class="self-center w-24 h-10 p-0 text-white rounded-lg bg-primary-400" (click)="calculateDiscount()" [disabled]="vouchers.invalid">Add</button>
          </div>

        </form>
        <div *ngIf="!addVoucher" class="flex justify-between mt-8 min-h-14 2xl:h-20">
          <button (click)="prevClick.emit('')" class="self-center w-24 h-10 text-xs text-gray-600 bg-gray-300 rounded-lg 2xl:h-12">Back</button>
          <button [disabled]="subDeals.length == 0" (click)="nextClick.emit('')" class="self-center w-32 h-10 text-xs text-white rounded-lg 2xl:h-12 bg-primary-400">Save & next</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!--Create Deal Modal-->

<app-reusable-modal #modal [modalConfig]="modalConfig">
  <div class="p-0 modal-body">
    <div class="flex justify-end p-0 m-0">
      <button class="p-3 m-2 btn btn-sm btn-icon btn-bg-light btn-active-color-primary" (click)="closeModal()" style="
       border-radius: 100%;">
        <span class="text-gray-800 fs-6">x</span>
      </button>
    </div>
    <div>
      <form class="px-6 mt-2 md:px-11 form" [formGroup]="vouchers">
        <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Voucher type</label>
            <input maxlength="16" appTrim type="text" class="form-control" formControlName="subTitle" name="subTitle"
            [ngClass]="{
            'is-invalid': vouchers.controls['subTitle']?.invalid && vouchers.controls['subTitle']?.touched,
            'is-valid': vouchers.controls['subTitle']?.valid}">
          <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'required',
            message: 'Deal Subtitle is required',
            control: vouchers.controls['subTitle']
          }">
        </ng-container>
        <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
            validation: 'minlength',
            message: 'Subtitle should at least be 3 characters',
            control: vouchers.controls['subTitle']
          }">
        </ng-container>
        <ng-container *ngIf="!vouchers.controls['subTitle']?.errors?.['minlength']" [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
          validation: 'pattern',
          message: 'Only alphabets are allowed',
          control: vouchers.controls['subTitle']
        }">
        </ng-container>
        </div>

        <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Original Price</label>
            <span class="absolute flex items-center h-11 "><i style="font-size:10px;" class="p-2 ml-2 text-white bg-gray-500 rounded fas fa-euro-sign fa-lg"></i></span>
            <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="originalPrice"
            [ngClass]="{
            'is-invalid':  vouchers.controls['originalPrice']?.invalid &&  vouchers.controls['originalPrice']?.touched,
            'is-valid':  vouchers.controls['originalPrice']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Original Price is required',
              control: vouchers.controls['originalPrice']
            }">
            </ng-container>
          </div>

          <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Deal Price</label>
            <span class="absolute flex items-center h-11"><i style="font-size:10px;" class="p-2 ml-2 text-white rounded fas fa-euro-sign fa-lg bg-success"></i></span>
            <input maxlength="5" appNumbersOnly type="text" class="pl-12 form-control" formControlName="dealPrice" name="dealPrice"
            [ngClass]="{
            'is-invalid': vouchers.controls['dealPrice']?.invalid && vouchers.controls['dealPrice']?.touched,
            'is-valid': vouchers.controls['dealPrice']?.valid}">
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Deal Price is required',
              control: vouchers.controls['dealPrice']
            }">
            </ng-container>
          <div class="text-xs text-danger"
          *ngIf="vouchers.controls['dealPrice']?.errors?.['confirmedValidator']">
            The deal price cannot grater then the original price
            </div>
          </div>

          <div class="h-24 fv-row 2xl:h-26">
          <label class="form-label">Number of Available Vouchers</label>
            <div class="flex items-center justify-between h-8 border-2 border-white rounded-sm w-28">
              <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md hover:text-primary-500 hover:bg-primary-100" (click)="handleMinus()">-</button>
              <input maxlength="4" appNumbersOnly type="text" style="height: 24px !important;min-height: unset;" class="w-12 py-0.5 text-xs text-center rounded-md form-control" placeholder="0" formControlName="numberOfVouchers" name="numberOfVouchers">
              <button class="w-6 h-6 text-gray-500 bg-gray-200 rounded-md hover:text-primary-500 hover:bg-primary-100" (click)="handlePlus()">+</button>
            </div>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
              validation: 'required',
              message: 'Please specify number of vouchers',
              control: vouchers.controls['numberOfVouchers']
            }">
          </ng-container>
          <svg *ngIf="subDeals.length == 0" width="100%" height="25px">
            <line height="0.5px" x1="0" y1="13" x2="100%" y2="13" style="stroke-dasharray: 6, 6;stroke: #9BB3C8;stroke-width: 0.5px;"></line>
         </svg>
        </div>
      </form>
    </div>
  </div>

  <div class="border-none modal-footer">
    <button type="button" class="self-center w-24 h-10 text-xs text-white rounded-lg 2xl:h-12 bg-primary-400" (click)="calculateDiscount()" [disabled]="vouchers.invalid">Save</button>
  </div>
</app-reusable-modal>


<ng-template #formError let-control="control" let-message="message" let-validation="validation">
  <ng-container *ngIf="control?.hasError(validation) && (control.dirty || control.touched)">
    <div class="fv-plugins-message-container">
      <div class="text-xs fv-help-block">
        {{ message }}
      </div>
    </div>
  </ng-container>
</ng-template>
